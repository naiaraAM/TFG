#!/bin/bash

root_directory=../../samples
output_directory=../../results_analysis
output_file="example.tsv"  # Using .tsv extension for clarity

# If file exists, delete it
if [ -f "$output_directory/$output_file" ]; then
    rm "$output_directory/$output_file"
fi
echo -e "filename\ttype\tsource\tfirst_bytes" > "$output_directory/$output_file"

find "$root_directory" -type f -print | while read -r file; do
    filename=$(basename "$file")
    type=$(basename "$(dirname "$file")")
    source=$(basename "$(dirname "$(dirname "$file")")")
    first_bytes=$(pedis --entrypoint -i 10 "$file" | cut -d' ' -f29-44 | od -c | cut -d' ' -f2- | tr -d '\n' | sed -e 's/ //g' -e 's/\\n//g')

    echo -e "$filename\t$type\t$source\t$first_bytes" >> "$output_directory/$output_file"
done